<header class="bg-white shadow-sm sticky top-0 z-50">
  <div class="container mx-auto px-4">
    <nav class="flex items-center justify-between flex-wrap py-4">
      <div class="flex items-center flex-shrink-0 mr-6">
        <a href="/" class="font-bold text-xl text-blue-600 flex items-center">
          <span>Cubeeto</span>
        </a>
      </div>
      
      <div class="block lg:hidden">
        <button id="mobile-menu-button" class="flex items-center px-3 py-2 border rounded text-gray-500 border-gray-500 hover:text-blue-600 hover:border-blue-600">
          <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <title>Menu</title>
            <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"/>
          </svg>
        </button>
      </div>
      
      <div id="mobile-menu" class="w-full hidden flex-grow lg:flex lg:items-center lg:w-auto">
        <div class="text-sm lg:flex-grow">
          <a href="/" class="block mt-4 lg:inline-block lg:mt-0 nav-link <%= path === '/' ? 'nav-link-active' : '' %>">
            Home
          </a>
          <a href="/marketplace" class="block mt-4 lg:inline-block lg:mt-0 nav-link <%= path && path.startsWith('/marketplace') ? 'nav-link-active' : '' %>">
            Marketplace
          </a>
          <a href="/renting" class="block mt-4 lg:inline-block lg:mt-0 nav-link <%= path && path.startsWith('/renting') ? 'nav-link-active' : '' %>">
            Renting
          </a>
          <a href="/notebank" class="block mt-4 lg:inline-block lg:mt-0 nav-link <%= path && path.startsWith('/notebank') ? 'nav-link-active' : '' %>">
            NoteBank
          </a>
          <a href="/studykit" class="block mt-4 lg:inline-block lg:mt-0 nav-link <%= path && path.startsWith('/studykit') ? 'nav-link-active' : '' %>">
            Study Kit
          </a>
        </div>
        
        <div class="mt-4 lg:mt-0">
  <% if (user) { %>
    <div class="relative inline-block text-left w-full max-w-xs">
  <button id="userMenuButton" class="btn btn-primary w-full flex justify-between items-center px-4 py-2 rounded-md focus:outline-none">
    <span><%= user.name.split(' ')[0] %></span>
    <svg class="h-4 w-4 fill-current ml-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
      <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
    </svg>
  </button>

  <div id="userDropdownMenu" class="hidden absolute right-0 w-48 mt-2 bg-white rounded-md shadow-lg z-50 origin-top-right sm:right-0 sm:w-48">
    <div class="py-1">
      <a href="/dashboard" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Dashboard</a>
      <% if (user.isAdmin) { %>
        <a href="/admin/dashboard" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Admin Panel</a>
      <% } %>
      <a href="/auth/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
    </div>
  </div>
</div>
  <% } else { %>
    <a href="/auth/login" class="btn btn-secondary inline-block mr-2">Login</a>
    <a href="/auth/register" class="btn btn-primary inline-block">Register</a>
  <% } %>
</div>
      </div>
    </nav>
  </div>
</header>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const button = document.getElementById("userMenuButton");
    const menu = document.getElementById("userDropdownMenu");

    button.addEventListener("click", function (event) {
      event.stopPropagation();
      menu.classList.toggle("hidden");
    });

    document.addEventListener("click", function () {
      menu.classList.add("hidden");
    });
  });
</script>